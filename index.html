<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Notification Demo</title>

<style>
body{
  font-family:Arial, sans-serif;
  background:#111827;
  color:#e5e7eb;
  margin:0;
  padding:20px;
}
.main{
  max-width:420px;
  margin:auto;
  background:#1f2933;
  padding:20px;
  border-radius:12px;
}
button,input{
  width:100%;
  padding:10px;
  margin-top:10px;
  border-radius:6px;
  border:none;
  font-size:15px;
}
button{cursor:pointer}
.primary{background:#4f46e5;color:#fff}
.danger{background:#ef4444;color:#fff}
.stop{background:#6b7280;color:#fff}
.notice{
  background:#fbbf24;
  color:#111827;
  padding:8px;
  border-radius:6px;
  font-size:13px;
  margin-bottom:10px;
}
.stat{
  margin-top:15px;
  background:#020617;
  padding:10px;
  border-radius:6px;
}
.bar{
  height:10px;
  background:#22c55e;
  width:0%;
  border-radius:6px;
  margin-top:6px;
}
#toastArea{
  position:fixed;
  right:16px;
  bottom:16px;
  display:flex;
  flex-direction:column;
  gap:10px;
}
.toast{
  background:#020617;
  padding:12px;
  border-radius:10px;
  width:280px;
}
.footer{
  text-align:center;
  margin-top:20px;
  font-size:13px;
  opacity:.6;
}
</style>
</head>

<body>

<div class="main">
  <h2>üîî Notification Experiment</h2>

  <div class="notice">
    On Windows & GitHub Pages, notifications use a visual preview.
  </div>

  <input id="title" placeholder="Notification title">
  <input id="msg" placeholder="Notification message">

  <button class="primary" onclick="sendOne()">Send Notification</button>
  <button class="danger" onclick="startSpam()">Fake ‚ÄúHacked‚Äù Demo</button>
  <button class="stop" onclick="stopSpam()">Stop</button>

  <div class="stat">
    Notifications sent: <strong id="count">0</strong>
    <div class="bar" id="bar"></div>
  </div>

  <div class="footer">¬© Copyright FilipoPencil 2026</div>
</div>

<div id="toastArea"></div>

<script>
/* ---------- ENV ---------- */
const isWindows = /Win/i.test(navigator.userAgent);
const isGithub = location.hostname.includes("github.io");

/* ---------- STATE ---------- */
let sent = 0;
let timers = [];

/* ---------- UI ---------- */
const countEl = document.getElementById("count");
const barEl = document.getElementById("bar");

/* ---------- CORE FIX ---------- */
/*
  ONE function:
  - increments stat
  - updates UI
  - shows notification
*/
function notify(title, body){
  // ALWAYS increment first
  sent++;
  countEl.textContent = sent;
  barEl.style.width = Math.min(sent,100) + "%";

  // Show notification
  if(isWindows || isGithub){
    showToast(title, body);
  } else {
    try {
      new Notification(title, { body });
    } catch {
      showToast(title, body);
    }
  }
}

/* ---------- TOAST ---------- */
function showToast(title, body){
  const t = document.createElement("div");
  t.className = "toast";
  t.innerHTML = `<strong>${title}</strong><div>${body}</div>`;
  toastArea.appendChild(t);
  setTimeout(()=>t.remove(), 3000);
}

/* ---------- ACTIONS ---------- */
function sendOne(){
  notify(
    title.value || "Demo",
    msg.value || "Hello from the demo"
  );
}

function startSpam(){
  stopSpam();
  for(let i=0;i<30;i++){
    const id = setTimeout(()=>{
      notify("SECURITY ALERT", msg.value || "Unusual activity detected");
    }, i*200);
    timers.push(id);
  }
}

function stopSpam(){
  while(timers.length) clearTimeout(timers.pop());
}
</script>

</body>
</html>
